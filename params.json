{
  "name": "VEQM: Variance association mapping for molecular phenotypes",
  "tagline": "",
  "body": "# VEQM\r\n\r\nGenetic loci which are associated with the variance, rather than the mean, of a trait are known as v-eQTL. These can indicate the presence of genetic interactions, gene-environment interactions, parent of origin effects, linkage with mean effect variants, or canalisation. This package provides a tool for discovering these loci affecting molecular phenotypes.\r\n\r\n***\r\n\r\n## Contents\r\n\r\n1. [Downloading VEQM](#downloading-veqm)\r\n2. [Input data formats](#input-data-formats)\r\n3. [Mapping v-eQTL](#mapping-v-eqtl)\r\n4. [Mapping variance effects related to parent of origin eQTL](#mapping-variance-effects-related-to-parent-of-origin-eqtl)\r\n5. [Processing results](#processing-results)\r\n6. [Building from source](#building-from-source)\r\n\r\n***\r\n\r\n## Downloading VEQM\r\n\r\nVEQM binaries can be downloaded from here:\r\n\r\nhttps://github.com/funpopgen/VEQM/releases/tag/v1.0\r\n\r\nThe standard binary is called VEQM. Use VEQM_CentOS if there is an error referring to GLIBC.\r\n\r\nIf there are any issues, you can try [building from source](#building-from-source), or contact andrew.brown@unige.ch.\r\n\r\n***\r\n\r\n## Input data formats\r\n\r\nVEQM uses the same data formats as fastQTL (http://fastqtl.sourceforge.net/), with the exception that the bed file should be uncompressed. To convert the fastQTL bed file run the following line:\r\n\r\n    gunzip myphenotypefile.bed.gz\r\n\r\n***\r\n\r\n## Mapping v-eQTL\r\n\r\nv-eQTL, SNPs associated with the variance of gene expression, can be caused by epistasis, gene-environment interactions, and partial linkage with eQTL [(Brown et al., 2014)](https://elifesciences.org/content/3/e01381).\r\n\r\nTo run VEQM, all that is necessary is a bed file containing expression values (expression.bed) and a vcf file containing genotype values (genotype.vcf.gz, either the DS or GT field must be present).\r\n\r\nVEQM has been designed so that the full analysis can be broken up into chunks, which can be submitted as cluster jobs separately. This requires two flags (if neither are present the whole analysis will be submitted), --genes specifies the number of genes to be analysed in each job, --job-number indexes the job. Therefore, if --genes 10 is specified, --job-number 1 will analyse genes 1-10 in the bed file, --job-number 2 will process genes 11-20 and so on.\r\n\r\nTo submit a job array, with a bed file of 9,995 genes, where each job analyses 50 genes (9,995 / 50 = 199.9, so we need to run 200 jobs to cover all genes), we would submit the following command to an LSF cluster:\r\n\r\n     bsub -o out -J\"VEQM[1-200]\" \\\r\n         \"VEQM --bed expression.bed --vcf genotype.vcf.gz --genes 50 \\\r\n         --job-number \\$LSB_JOBINDEX --out results\\$LSB_JOBINDEX\"\r\n\r\nIn addition, the --perm option allows you to set the number of permutations used in the analysis, and optionally a seed.\r\n\r\nEach results file should look like this:\r\n\r\n![VEQM results example](screenshots/VEQM.results.png)\r\n\r\nThe first 5 columns indicate the gene and SNP (specified by chromosome, location, and reference and alternate alleles), then we report the Spearman correlation between the \"distance\" measure and genotype (positive indicates increased variance with the alternate allele), P value, permutation P value (not controlled for multiple testing), permutation P value controlled for multiple testing across the SNPs, and the beta approximation adjusted P value.\r\n\r\n## Mapping variance effects related to parent of origin eQTL\r\n\r\nParent of origin eQTL occur when the effect of a genetic variant on expression depends on whether the variant is inherited from the mother or the father. Such effects can be observed as an increase in variance in the heterozygote group [(Hoggart et al., 2014)](http://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1004508). It is recommended that the genotype file only contain variants with reasonable numbers of minor allele homozygotes and heterozygotes if this analysis is run (we recommend more than 50 in both categories), as otherwise standard v-eQTL could mistakenly be discovered. The command to run this analysis is the same as the standard analysis, with the addition of the flag **--het**:\r\n\r\n     bsub -o out -J\"VEQM[1-200]\" \\\r\n         \"VEQM --bed expression.bed --vcf genotype.vcf.gz --genes 50 \\\r\n         --job-number \\$LSB_JOBINDEX --het --out results\\$LSB_JOBINDEX\"\r\n\r\n## Processing results\r\n\r\nRunning the commands described above will produce 200 results files, results1-results200. To concatenate them together run:\r\n\r\n     awk 'FNR>1||NR==1' results* > results.all\r\n\r\n\r\nThe output should look like this:\r\n\r\n    cat <(head -1 results.all) <(tail -n+2 results.all |  \\\r\n        awk '{if (best[$1]==\"\" || p_best[$1] > $7) {best[$1] = $0; p_best[$1]=$7}} \\\r\n\t    END{for (var in best) print best[var]}') > results.best\r\n\r\nThe results are corrected for multiple testing across the SNPs. To correct for multiple testing across the genes as well, we can use the [qvalue package](http://genomine.org/papers/Storey_FDR_2011.pdf) in R.\r\n\r\nWithin R, load the data with the following command:\r\n\r\n    results <- read.table(file = \"results.best\", header = T)\r\n\r\nA new object with adjusted P values can then be calculated:\r\n\r\n    library(qvalue)\r\n    results <- data.frame(results, Qvalues = qvalue(results$Beta)$qvalues)\r\n\r\nTo write out this table, run:\r\n\r\n    write.table(results, file = \"results.adjusted\", col.names = T, row.names = F, sep = '\\t', quote = F)\r\n\r\nThe final column in results.adjusted now contains P values, estimating the false discovery rate while accounting for all SNPs and genes tested.\r\n    \r\n***\r\n\r\n## Building from source\r\n\r\nThis requires a D compiler and a version of the GNU scientific library to be installed. Running the command:\r\n\r\n    gsl-config --version\r\n\r\nshould report the gsl version. If this fails, please follow the instructions [here](https://www.gnu.org/software/gsl/) to install the library, or contact your system administrator.\r\n\r\n### Cloning the repository\r\n\r\nFirst, clone the repository by running:\r\n\r\n    git clone https://github.com/funpopgen/veqm.git\r\n\r\nThis should create a folder called veqm. Inside this folder is a file called makefile, in the first two lines we can specify the location of the D compiler.\r\n\r\n### Download a D compiler\r\n\r\nThen, download a D compiler from either here: https://github.com/ldc-developers/ldc/releases or here: http://dlang.org/dmd-linux.html (ldc produces faster software, my experience is that dmd works better on older operating systems). Decompress the downloaded file, then edit either the first or second line of the makefile in the VEQM folder so that it contains the full path to the relevant compiler, i.e. either:\r\n\r\n**DMD = /path/to/dmd2/linux/bin64/dmd**\r\n\r\nor\r\n\r\n**LDC = /path/to/ldc2-1.1.0-beta2-linux-x86_64/bin/ldc2**\r\n\r\n### Building the software\r\n\r\nNow to compile, if you downloaded the ldc compiler, run the following command:\r\n\r\n    make test && make\r\n\r\nFor dmd run:\r\n\r\n    make dmd_test && make dmd\r\n\r\nNow the VEQM binary should be within the bin folder in the VEQM directory, running\r\n\r\n     ./bin/VEQM --help\r\n\r\nshould bring up the help.\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}